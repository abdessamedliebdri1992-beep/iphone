<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Memoji Studio</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto; }
        #video { width: 100vw; height: 100vh; object-fit: cover; }
        
        /* شريط الميموجي السفلي */
        .emoji-bar {
            position: absolute; bottom: 120px; width: 100%;
            display: flex; justify-content: center; gap: 15px;
            background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(10px);
            padding: 10px 0; overflow-x: auto;
        }
        .emoji-item { width: 60px; height: 60px; cursor: pointer; transition: 0.2s; }
        .emoji-item:active { transform: scale(1.2); }

        /* منطقة الميموجي على الشاشة */
        .memoji-overlay {
            position: absolute; top: 30%; left: 25%;
            width: 200px; height: 200px;
            cursor: move; touch-action: none;
            z-index: 10;
        }

        .shutter-btn {
            position: absolute; bottom: 30px; left: 50%;
            transform: translateX(-50%);
            width: 80px; height: 80px;
            border: 6px solid white; border-radius: 50%;
            background: none; outline: none;
        }
    </style>
</head>
<body>

    <video id="video" autoplay playsinline></video>
    
    <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Smiling%20Face%20with%20Sunglasses.png" id="activeMemoji" class="memoji-overlay">

    <div class="emoji-bar">
        <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Mind%20Blown.png" class="emoji-item" onclick="changeMemoji(this.src)">
        <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Thinking%20Face.png" class="emoji-item" onclick="changeMemoji(this.src)">
        <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Smiling%20Face%20with%20Sunglasses.png" class="emoji-item" onclick="changeMemoji(this.src)">
    </div>

    <button class="shutter-btn" onclick="capture()"></button>

    <script>
        const video = document.getElementById('video');
        const activeMemoji = document.getElementById('activeMemoji');

        // تشغيل الكاميرا
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
            .then(stream => { video.srcObject = stream; })
            .catch(err => alert("يرجى السماح بالكاميرا"));

        // تغيير الميموجي عند الضغط
        function changeMemoji(src) {
            activeMemoji.src = src;
        }

        // تحريك الميموجي باللمس
        activeMemoji.addEventListener('touchmove', (e) => {
            let touch = e.touches[0];
            activeMemoji.style.left = (touch.clientX - 100) + 'px';
            activeMemoji.style.top = (touch.clientY - 100) + 'px';
        });

        function capture() {
            window.Telegram.WebApp.showAlert("تم التقاط اللحظة! (سيتم تفعيل الحفظ قريباً)");
        }

        window.Telegram.WebApp.ready();
    </script>
</body>
    </html>
